Object.defineProperty(exports,"__esModule",{value:!0});var e=require("@urql/core"),r=require("wonka"),t=require("graphql"),i=e=>e.name.value,a=e=>e.typeCondition.name.value,n=e=>e.alias?e.alias.value:e.name.value,o=[],s=e=>e.selectionSet?e.selectionSet.selections:o,l=e=>e.typeCondition?e.typeCondition.name.value:null,u=e=>e.kind===t.Kind.FIELD,d=e=>e.kind===t.Kind.INLINE_FRAGMENT,p=(e,r)=>{var a=null;if(e.arguments)for(var n=0,o=e.arguments.length;n<o;n++){var s=e.arguments[n],l=t.valueFromASTUntyped(s.value,r);null!=l&&(a||(a={}),a[i(s)]=l)}return a},v=(e,r)=>{if(r&&e.variableDefinitions){for(var t={},a=0,n=e.variableDefinitions.length;a<n;a++){var o=i(e.variableDefinitions[a].variable);t[o]=r[o]}return t}},f=(e,r)=>{var a={};if(!r)return a;if(e.variableDefinitions)for(var n=0,o=e.variableDefinitions.length;n<o;n++){var s=e.variableDefinitions[n],l=i(s.variable);a[l]=void 0===r[l]&&s.defaultValue?t.valueFromASTUntyped(s.defaultValue,r):r[l]}for(var u in r)u in a||(a[u]=r[u]);return a};function y(e,r,t){if(!e){var i=new Error((r||"Minfied Error #"+t+"\n")+"\nhttps://bit.ly/2XbVrpR#"+t);throw i.name="Graphcache Error",i}}new Set;var c=e=>{for(var r=0;r<e.definitions.length;r++)if(e.definitions[r].kind===t.Kind.OPERATION_DEFINITION)return e.definitions[r];y(!1,"",1)},m=e=>{for(var r={},a=0;a<e.definitions.length;a++){var n=e.definitions[a];n.kind===t.Kind.FRAGMENT_DEFINITION&&(r[i(n)]=n)}return r},h=(e,r)=>{for(var a=0;e.directives&&a<e.directives.length;a++){var n=e.directives[a],o=i(n);if(("include"===o||"skip"===o)&&n.arguments&&n.arguments[0]&&"if"===i(n.arguments[0])){var s=t.valueFromASTUntyped(n.arguments[0].value,r);return"include"===o?!!s:!s}}return!0},g=(e,r)=>{for(var a=0;e.directives&&a<e.directives.length;a++){var n=e.directives[a];if("defer"===i(n)){for(var o=0;n.arguments&&o<n.arguments.length;o++){var s=n.arguments[a];if("if"===i(s))return!!t.valueFromASTUntyped(s.value,r)}return!0}}return!1},k=(e,r,t)=>{var i=w(e,r,t);return!!i&&"NON_NULL"!==i.type.kind},_=(e,r,t)=>{var i=w(e,r,t);if(!i)return!1;var a="NON_NULL"===i.type.kind?i.type.ofType:i.type;return"LIST"===a.kind&&"NON_NULL"!==a.ofType.kind},O=(e,r,t)=>{if(!t)return!1;var i=l(r);return!i||t===i||(e.types.has(i)&&"OBJECT"===e.types.get(i).kind?i===t:(function(e,r){y(e.types.has(r)&&("INTERFACE"===e.types.get(r).kind||"UNION"===e.types.get(r).kind),"",5)}(e,i),b(e,t),e.isSubType(i,t)))},w=(e,r,t)=>{if(0!==t.indexOf("__")&&0!==r.indexOf("__"))return b(e,r),e.types.get(r).fields()[t]};function b(e,r){y(e.types.has(r)&&"OBJECT"===e.types.get(r).kind,"",3)}var q=(r,t)=>t?`${r}(${e.stringifyVariables(t)})`:r,x=(e,r)=>`${e}.${r}`,K=e=>{var r=e.indexOf("(");return r>-1?{fieldKey:e,fieldName:e.slice(0,r),arguments:JSON.parse(e.slice(r+1,-1))}:{fieldKey:e,fieldName:e,arguments:null}},N=e=>{var r=e.indexOf(".");return{entityKey:e.slice(0,r).replace(/%2e/g,"."),fieldKey:e.slice(r+1)}},E=()=>Object.create(null),M=null,S=null,A=null,T=null,F=null,L=null,D=!1,I=e=>{var r;if(e){if(M.has(e))return e;r=S.get(e)||{...e},S.set(e,r)}else r={};return M.add(r),r},C=e=>!!e&&M.has(e),$=(e,r,t,i)=>{M=new WeakSet,S=new WeakMap,A=e,T=r,F=new Set,D=!!i,t?"read"===A?L=t:i||r.optimisticOrder.length>1?(i||r.commutativeKeys.has(t)?i&&(-1===r.optimisticOrder.indexOf(t)||r.commutativeKeys.has(t)||r.optimisticOrder.splice(r.optimisticOrder.indexOf(t),1),r.commutativeKeys.delete(t)):re(r,t),L=t,te(r,t)):(L=null,ae(r,t)):L=null},R=()=>{var e=T,r=L;if(D=!1,L=null,r&&e.optimisticOrder.indexOf(r)>-1)for(var t=e.optimisticOrder.length;--t>=0&&e.refLock.has(e.optimisticOrder[t])&&e.commutativeKeys.has(e.optimisticOrder[t])&&!e.deferredKeys.has(e.optimisticOrder[t]);)ne(e.optimisticOrder[t]);M=null,S=null,A=null,T=null,F=null,e.defer||(e.defer=!0,setTimeout((()=>{$("read",e,null),W(),se(),R(),e.defer=!1})))},P=(e,r,t)=>{r&&!t&&e.deferredKeys.delete(r),$("write",e,r,t),R()},j=()=>(y(null!==F,"",2),F),U=(e,r,t,i)=>{var a=L?e.optimistic.get(L):e.base,n=a.get(r);void 0===n&&a.set(r,n=E()),void 0!==i||L?n[t]=i:delete n[t]},J=(e,r,t)=>{for(var i,a=!D&&"read"===A&&L&&T.commutativeKeys.has(L),n=0,o=T.optimisticOrder.length;n<o;n++){var s=T.optimisticOrder[n],l=e.optimistic.get(s);if(a=a&&s!==L,l&&(!a||!T.commutativeKeys.has(s))&&(!D||"write"===A||T.commutativeKeys.has(s))&&void 0!==(i=l.get(r))&&t in i)return i[t]}return void 0!==(i=e.base.get(r))?i[t]:void 0},Q=(e,r,t,i)=>{var a=r.get(t)||0,n=a+i;r.set(t,n),e&&(n<=0?e.add(t):a<=0&&n>0&&e.delete(t))},B=(e,r,t,i)=>{if("string"==typeof t)Q(e,r,t,i);else if(Array.isArray(t))for(var a=0,n=t.length;a<n;a++)Array.isArray(t[a])?B(e,r,t[a],i):t[a]&&Q(e,r,t[a],i)},V=(e,r,t)=>{if(void 0!==t)for(var i in t)r.has(i)||(e.push(K(i)),r.add(i))},G=(e,r,t,i)=>{V(e,r,i.base.get(t));for(var a=0,n=T.optimisticOrder.length;a<n;a++){var o=i.optimistic.get(T.optimisticOrder[a]);void 0!==o&&V(e,r,o.get(t))}},W=()=>{var{gc:e}=T;for(var r of e.keys()){if((T.refCount.get(r)||0)>0)return void e.delete(r);for(var t of T.refLock.keys()){var i=T.refLock.get(t);if(i){if((i.get(r)||0)>0)return;i.delete(r)}}T.refCount.delete(r),e.delete(r),T.records.base.delete(r);var a=T.links.base.get(r);if(a)for(var n in T.links.base.delete(r),a)B(e,T.refCount,a[n],-1)}},z=(e,r)=>{"__typename"!==r&&(e!==T.queryRootKey?F.add(e):void 0!==r&&F.add(x(e,r)))},X=(e,r)=>{!D&&T.storage&&T.persist.add(((e,r)=>`${e.replace(/\./g,"%2e")}.${r}`)(e,r))},H=(e,r)=>(z(e,r),J(T.records,e,r)),Y=(e,r)=>(z(e,r),J(T.links,e,r)),Z=(e,r,t)=>{z(e,r),X(e,r),U(T.records,e,r,t)},ee=(e,r,t)=>{var i,a,n,o=T;L?((i=o.refLock.get(L))||o.refLock.set(L,i=new Map),a=o.links.optimistic.get(L)):(i=o.refCount,a=o.links.base,n=o.gc);var s=a&&a.get(e),l=s&&s[r];z(e,r),X(e,r),U(o.links,e,r,t),B(n,i,l,-1),B(n,i,t,1)},re=(e,r,t)=>{t?e.deferredKeys.add(r):e.deferredKeys.delete(r);var i=e.optimisticOrder.indexOf(r);if(i>-1){if(!t&&e.commutativeKeys.has(r))return;e.optimisticOrder.splice(i,1),ie(e,r)}for(i=0;t&&i<e.optimisticOrder.length&&!e.deferredKeys.has(e.optimisticOrder[i])&&(!e.refLock.has(e.optimisticOrder[i])||!e.commutativeKeys.has(e.optimisticOrder[i]));i++);e.optimisticOrder.splice(i,0,r),e.commutativeKeys.add(r)},te=(e,r)=>{-1===e.optimisticOrder.indexOf(r)&&e.optimisticOrder.unshift(r),e.refLock.has(r)||(e.refLock.set(r,new Map),e.links.optimistic.set(r,new Map),e.records.optimistic.set(r,new Map))},ie=(e,r)=>{e.refLock.has(r)&&(e.refLock.delete(r),e.records.optimistic.delete(r),e.links.optimistic.delete(r),e.deferredKeys.delete(r))},ae=(e,r)=>{var t=e.optimisticOrder.indexOf(r);t>-1&&(e.optimisticOrder.splice(t,1),e.commutativeKeys.delete(r)),ie(e,r)},ne=e=>{var r=F;F=new Set;var t=T.links.optimistic.get(e);if(t)for(var i of t.entries()){var a=i[0],n=i[1];for(var o in n)ee(a,o,n[o])}var s=T.records.optimistic.get(e);if(s)for(var l of s.entries()){var u=l[0],d=l[1];for(var p in d)Z(u,p,d[p])}F=r,ae(T,e)},oe=e=>{var{links:r,records:t}=T,i=[],a=new Set;return z(e),G(i,a,e,r),G(i,a,e,t),i},se=()=>{if(T.storage){D=!0,A="read";var r=E();for(var t of T.persist.keys()){var{entityKey:i,fieldKey:a}=N(t),n=void 0;r[t]=void 0!==(n=Y(i,a))?`:${e.stringifyVariables(n)}`:void 0!==(n=H(i,a))?e.stringifyVariables(n):void 0}D=!1,T.storage.writeData(r),T.persist.clear()}},le={current:null},ue={current:!1},de=e=>e.__internal.path.length>0&&e.__internal.errorMap?e.__internal.errorMap[e.__internal.path.join(".")]:void 0,pe=(e,r,t,i,a,n,o)=>{var s={store:e,variables:r,fragments:t,parent:{__typename:i},parentTypeName:i,parentKey:a,parentFieldKey:"",fieldName:"",error:void 0,partial:!1,optimistic:!!n,__internal:{path:[],errorMap:void 0}};if(o&&o.graphQLErrors)for(var l=0;l<o.graphQLErrors.length;l++){var u=o.graphQLErrors[l];u.path&&u.path.length&&(s.__internal.errorMap||(s.__internal.errorMap=Object.create(null)),s.__internal.errorMap[u.path.join(".")]=u)}return s},ve=(e,r,t,i,a,n)=>{le.current=e,e.parent=r,e.parentTypeName=t,e.parentKey=i,e.parentFieldKey=a,e.fieldName=n,e.error=de(e)},fe=(e,r,t,a)=>{if(!r)return!1;var n=l(e);return!n||r===n||"write"===A||!s(e).some((e=>{if(!u(e))return!1;var r=q(i(e),p(e,a));return!((e,r)=>void 0!==H(e,r)||void 0!==Y(e,r))(t,r)}))},ye=(e,r,t,a)=>{var n,o=!1,l=0;return function(){if(!ue.current&&o&&(ue.current=o),n){var p=n();if(null!=p)return p;n=void 0,o=!1}for(;l<t.length;){var v=t[l++];if(h(v,a.variables)){if(u(v))return v;var f=d(v)?v:a.fragments[i(v)];if(void 0!==f&&(a.store.schema?O(a.store.schema,f,e):fe(f,e,r,a.variables)))return o=!!g(v,a.variables),!ue.current&&o&&(ue.current=o),(n=ye(e,r,s(f),a))()}}}},ce=e=>null==e?null:e,me=(e,r)=>{if(null==r)return r;if(Array.isArray(r)){for(var t=new Array(r.length),i=0,a=t.length;i<a;i++)t[i]=me(e,r[i]);return t}return e.keyOfEntity(r)},he=(e,r,t,i,a)=>{$("write",e.data,a||null);var n=ge(e,r,t,i);return R(),n},ge=(e,r,t,i,a)=>{var n=c(r.query),o={data:t,dependencies:j()},l=e.rootFields[n.operation],u=pe(e,f(n,r.variables),m(r.query),l,l,!!a,i);return ke(u,l,s(n),t),o},ke=(e,r,t,a)=>{var o=r===e.store.rootFields.query,l=!o&&!!e.store.rootNames[r],u=l||o?r:a.__typename;if(u){l||o||!r||Z(r,"__typename",u);for(var d,v=ye(u,r||u,t,e);d=v();){var f=i(d),y=p(d,e.variables),c=q(f,y),m=n(d),h=a[e.optimistic?f:m];if(!("__typename"===f||void 0===h&&ue.current)){e.__internal.path.push(m);var g=void 0;if(e.optimistic&&l){if(!(g=e.store.optimisticMutations[f]))continue}else e.optimistic&&"function"==typeof h&&(g=h);if(g&&(ve(e,a,u,u,c,f),h=ce(g(y||{},e.store,e))),d.selectionSet)if(r&&!l){var k=x(r,c),_=_e(e,s(d),ce(h),k);ee(r||u,c,_)}else _e(e,s(d),ce(h));else r&&!l&&Z(r||u,c,null===h&&de(e)?void 0:h);if(l){var O=e.store.updates[u][f];O&&(ve(e,a,u,u,x(u,c),f),a[f]=h,O(a,y||{},e.store,e))}e.__internal.path.pop()}}}},_e=(e,r,t,i)=>{if(Array.isArray(t)){for(var a=new Array(t.length),n=0,o=t.length;n<o;n++){e.__internal.path.push(n);var s=i?x(i,`${n}`):void 0,l=_e(e,r,t[n],s);a[n]=l,e.__internal.path.pop()}return a}if(null===t)return de(e)?void 0:null;var u=e.store.keyOfEntity(t)||i;return ke(e,u,r,t),u||null};class Oe{constructor(e){Oe.prototype.__init.call(this),Oe.prototype.__init2.call(this),e||(e={}),this.resolvers=e.resolvers||{},this.optimisticMutations=e.optimistic||{},this.keys=e.keys||{};var r,t="Query",i="Mutation",a="Subscription";if(e.schema){var n=(({__schema:e})=>{var r=new Map,t=e=>{var r;return()=>{if(!r){r={};for(var t=0;t<e.length;t++)r[e[t].name]=e[t]}return r}},i=e=>{switch(e.kind){case"OBJECT":case"INTERFACE":return{name:e.name,kind:e.kind,interfaces:t(e.interfaces||[]),fields:t(e.fields.map((e=>({name:e.name,type:e.type,args:t(e.args)}))))};case"UNION":return{name:e.name,kind:e.kind,types:t(e.possibleTypes||[])}}},a={query:e.queryType?e.queryType.name:null,mutation:e.mutationType?e.mutationType.name:null,subscription:e.subscriptionType?e.subscriptionType.name:null,types:void 0,isSubType(e,t){var i=r.get(e),a=r.get(t);return!!(i&&a&&("UNION"===i.kind?i.types()[t]:"OBJECT"!==i.kind&&"OBJECT"===a.kind?a.interfaces()[e]:e===t))}};if(e.types){a.types=r;for(var n=0;n<e.types.length;n++){var o=e.types[n];if(o&&o.name){var s=i(o);s&&r.set(o.name,s)}}}return a})(e.schema);t=n.query||t,i=n.mutation||i,a=n.subscription||a,n.types&&(this.schema=n)}this.updates={[i]:e.updates&&e.updates.Mutation||{},[a]:e.updates&&e.updates.Subscription||{}},this.rootFields={query:t,mutation:i,subscription:a},this.rootNames={[t]:"query",[i]:"mutation",[a]:"subscription"},this.data=(r=t,{defer:!1,gc:new Set,persist:new Set,queryRootKey:r,refCount:new Map,refLock:new Map,links:{optimistic:new Map,base:new Map},records:{optimistic:new Map,base:new Map},deferredKeys:new Set,commutativeKeys:new Set,optimisticOrder:[],storage:null})}__init(){this.keyOfField=q}keyOfEntity(e){return le.current&&e===le.current.parent?le.current.parentKey:null==e||"string"==typeof e?e||null:e.__typename?this.rootNames[e.__typename]?e.__typename:(this.keys[e.__typename]?r=this.keys[e.__typename](e):null!=e.id?r=`${e.id}`:null!=e._id&&(r=`${e._id}`),r?`${e.__typename}:${r}`:null):null;var r}resolve(e,r,t){var i=q(r,t),a=this.keyOfEntity(e);if(!a)return null;var n=H(a,i);return void 0!==n?n:Y(a,i)||null}__init2(){this.resolveFieldByKey=this.resolve}invalidate(e,r,t){var i=this.keyOfEntity(e);y(i,"",19),((e,r,t)=>{for(var i=r?[{fieldKey:q(r,t)}]:oe(e),a=0,n=i.length;a<n;a++){var{fieldKey:o}=i[a];void 0!==Y(e,o)?ee(e,o,void 0):Z(e,o,void 0)}})(i,r,t)}inspectFields(e){var r=this.keyOfEntity(e);return r?oe(r):[]}updateQuery(r,t){var i=e.createRequest(r.query,r.variables);i.query=e.formatDocument(i.query);var a=t(this.readQuery(i));null!==a&&ge(this,i,a)}readQuery(r){var t=e.createRequest(r.query,r.variables);return t.query=e.formatDocument(t.query),be(this,t).data}readFragment(r,t,i,a){return Ke(this,e.formatDocument(r),t,i,a)}writeFragment(r,t,i,n){((e,r,t,i,n)=>{var o,l=m(r);if(n){if(!(o=l[n]))return null}else if(!(o=l[Object.keys(l)[0]]))return null;var u=a(o),d={__typename:u,...t},p=e.keyOfEntity(d);if(p){var v=pe(e,i||{},l,u,p,void 0);ke(v,p,s(o),d)}})(this,e.formatDocument(r),t,i,n)}link(e,r,t,i){var a=void 0!==i?t:null,n=void 0!==i?i:t,o=me(this,e);"string"==typeof o&&ee(o,q(r,a),me(this,n))}}var we=(e,r,t,i,a)=>{$("read",e.data,a);var n=be(e,r,t,i);return R(),n},be=(e,r,t,i)=>{var a=c(r.query),n=e.rootFields[a.operation],o=s(a),l=pe(e,f(a,r.variables),m(r.query),n,n,!1,i);t||(t=I());var u=n!==l.store.rootFields.query?qe(l,n,o,t):Ne(l,n,o,t);return{dependencies:j(),partial:l.partial||!u,data:u||null}},qe=(e,r,t,i)=>{if("string"!=typeof(e.store.rootNames[r]?r:i.__typename))return i;for(var a,o=ye(r,r,t,e),l=!1,u=I(i);a=o();){var d,p=n(a),v=i[p];e.__internal.path.push(p),d=a.selectionSet&&null!==v?xe(e,s(a),ce(v)):v,l=l||d!==v,void 0!==d&&(u[p]=d),e.__internal.path.pop()}return l?u:i},xe=(e,r,t)=>{if(Array.isArray(t)){for(var i=new Array(t.length),a=!1,n=0,o=t.length;n<o;n++)e.__internal.path.push(n),i[n]=xe(e,r,t[n]),a=a||i[n]!==t[n],e.__internal.path.pop();return a?i:t}if(null===t)return null;var s=e.store.keyOfEntity(t);return null!==s?Ne(e,s,r,t)||null:qe(e,t.__typename,r,t)},Ke=(e,r,t,i,n)=>{var o,l=m(r);if(n){if(!(o=l[n]))return null}else if(!(o=l[Object.keys(l)[0]]))return null;var u=a(o);"string"==typeof t||t.__typename||(t.__typename=u);var d=e.keyOfEntity(t);if(!d)return null;var p=pe(e,i||{},l,u,d);return Ne(p,d,s(o),I())||null},Ne=(e,r,t,a,o)=>{var{store:l}=e,u=r===l.rootFields.query,d=o&&l.keyOfEntity(o)||r,v=u?r:H(d,"__typename")||o&&o.__typename;if("string"==typeof v&&(!o||v===o.__typename)){for(var f,c=ye(v,d,t,e),m=!1,h=!1,g=v!==a.__typename,_=I(a);void 0!==(f=c());){var O=i(f),w=p(f,e.variables),b=n(f),K=q(O,w),N=x(d,K),E=H(d,K),M=o?o[O]:void 0,S=l.resolvers[v];e.__internal.path.push(b);var T=void 0;if("__typename"===O)T=v;else if(void 0!==M&&void 0===f.selectionSet)T=M;else if("read"===(y(null!==A,"",2),A)&&S&&"function"==typeof S[O]){if(ve(e,_,v,d,N,O),void 0!==E&&(_[b]=E),T=S[O](_,w||{},l,e),f.selectionSet&&(T=Ee(e,v,O,N,s(f),void 0!==_[b]?_[b]:a[b],T,C(a))),l.schema&&null===T&&!k(l.schema,v,O))return}else if(f.selectionSet)if(void 0!==M)T=Ee(e,v,O,N,s(f),void 0!==_[b]?_[b]:a[b],M,C(a));else{var F=Y(d,K);void 0!==F?T=Me(e,F,v,O,s(f),void 0!==_[b]?_[b]:a[b],C(a)):"object"==typeof E&&null!==E&&(T=E)}else T=E;if(void 0===T&&ue.current)m=!0;else if(void 0===T&&(l.schema&&k(l.schema,v,O)||de(e)))h=!0,T=null;else{if(void 0===T)return void e.__internal.path.pop();m=m||"__typename"!==O}e.__internal.path.pop(),g=g||T!==a[b],void 0!==T&&(_[b]=T)}return e.partial=e.partial||h,u&&h&&!m?void 0:g?_:a}},Ee=(e,r,t,i,a,n,o,s)=>{if(Array.isArray(o)){for(var{store:l}=e,u=!!l.schema&&_(l.schema,r,t),d=new Array(o.length),p=!Array.isArray(n)||o.length!==n.length,v=0,f=o.length;v<f;v++){e.__internal.path.push(v);var y=Ee(e,r,t,x(i,`${v}`),a,null!=n?n[v]:void 0,o[v],s);if(e.__internal.path.pop(),void 0===y&&!u)return;e.partial=e.partial||void 0===y&&u,d[v]=null!=y?y:null,p=p||d[v]!==n[v]}return p?d:n}if(null==o)return o;if(s&&null===n)return null;if(Se(o)){var c=n||I();return"string"==typeof o?Ne(e,o,a,c):Ne(e,i,a,c,o)}},Me=(e,r,t,i,a,n,o)=>{if(Array.isArray(r)){for(var{store:s}=e,l=!!s.schema&&_(s.schema,t,i),u=new Array(r.length),d=!Array.isArray(n)||u.length!==n.length,p=0,v=r.length;p<v;p++){e.__internal.path.push(p);var f=Me(e,r[p],t,i,a,null!=n?n[p]:void 0,o);if(e.__internal.path.pop(),void 0===f&&!l)return;e.partial=e.partial||void 0===f&&l,u[p]=f||null,d=d||u[p]!==n[p]}return d?u:n}return null===r||null===n&&o?null:Ne(e,r,a,n||I())},Se=e=>"string"==typeof e||"object"==typeof e&&"string"==typeof e.__typename,Ae=(r,t)=>e.makeOperation(r.kind,r,{...r.context,meta:{...r.context.meta,cacheOutcome:t}}),Te=(r,t)=>e.makeOperation(r.kind,r,{...r.context,requestPolicy:t}),Fe=t=>({forward:i,client:a})=>{var n=new Oe(t);t&&t.storage&&t.storage.readData().then((e=>{((e,r,t)=>{for(var i in $("write",e,null),t){var a=t[i];if(void 0!==a){var{entityKey:n,fieldKey:o}=N(i);":"===a[0]?void 0===Y(n,o)&&ee(n,o,JSON.parse(a.slice(1))):void 0===H(n,o)&&Z(n,o,JSON.parse(a))}}R(),e.storage=r})(n.data,t.storage,e)}));var o=new Map,s=[],l=new Map,u=new Map,d=new Set,p=new Set,f=new Map,y=e=>{for(var r of e.values())if(d.has(r))return!0;return!1},m=(e,r)=>{if(r)for(var t of r.values()){var i=f.get(t);if(i)for(var a of i.values())e.add(a)}},h=(e,r)=>{for(var t of r.values())if(t!==e.key){var i=l.get(t);if(i){l.delete(t);var n="cache-first";p.has(t)&&(p.delete(t),n="cache-and-network"),a.reexecuteOperation(Te(i,n))}}},g=r=>{if("query"===r.kind)re(n.data,r.key);else if("teardown"===r.kind)l.delete(r.key),u.delete(r.key),P(n.data,r.key);else if("mutation"===r.kind&&"network-only"!==r.context.requestPolicy){var{dependencies:t}=((e,r,t)=>{$("write",e.data,t,!0);var i=ge(e,r,{},void 0,!0);return R(),i})(n,r,r.key);if(t.size){for(var i of t.values())d.add(i);o.set(r.key,t);var a=new Set;m(a,t),h(r,a)}}return e.makeOperation(r.kind,{key:r.key,query:e.formatDocument(r.query),variables:r.variables?v(c(r.query),r.variables):r.variables},r.context)},k=(e,r)=>{for(var t of r.values()){var i=f.get(t);i||f.set(t,i=new Set),i.add(e.key),l.set(e.key,e)}},_=e=>{var r=we(n,e,u.get(e.key)),t=r.data?r.partial?"partial":"hit":"miss";return u.set(e.key,r.data),k(e,r.dependencies),{outcome:t,operation:e,data:r.data,dependencies:r.dependencies}},O=(e,r)=>{var t,{operation:i,error:a,extensions:s}=e,{key:l}=i;if("mutation"===i.kind){var d=o.get(l);m(r,d),o.delete(l)}re(n.data,i.key,"subscription"===i.kind||e.hasNext);var p=e.data;if(p){var v=he(n,i,p,e.error,l).dependencies;m(r,v);var f=we(n,i,"query"===i.kind&&u.get(i.key)||p,e.error,l);p=f.data,"query"===i.kind&&(m(r,t=f.dependencies),u.set(i.key,e.data))}else P(n.data,i.key);return t&&k(e.operation,t),{data:p,error:a,extensions:s,operation:i}};return e=>{var t=r.share(e),l=r.share(r.map(_)(r.filter((e=>"query"===e.kind&&"network-only"!==e.context.requestPolicy))(t))),u=r.filter((e=>"query"!==e.kind||"network-only"===e.context.requestPolicy))(t),v=r.map((e=>Ae(e.operation,"miss")))(r.filter((e=>"miss"===e.outcome&&"cache-only"!==e.operation.context.requestPolicy&&!y(e.dependencies)))(l)),f=r.map((e=>{var{operation:r,outcome:t,dependencies:i}=e,n={operation:Ae(r,t),data:e.data,error:e.error,extensions:e.extensions};return("cache-and-network"===r.context.requestPolicy||"cache-first"===r.context.requestPolicy&&"partial"===t)&&(n.stale=!0,y(i)?"cache-and-network"===r.context.requestPolicy&&p.add(r.key):a.reexecuteOperation(Te(r,"network-only"))),n}))(r.filter((e=>"miss"!==e.outcome||"cache-only"===e.operation.context.requestPolicy))(l)),c=r.share(i(r.map(g)(r.merge([u,v])))),m=r.map((e=>{var r=new Set,t=O(e,r);return h(e.operation,r),t}))(r.filter((e=>!o.has(e.operation.key)))(c)),k=r.mergeMap((e=>{if(s.push(e)<o.size)return r.empty;for(var t=0;t<s.length;t++)re(n.data,s[t].operation.key);d.clear();for(var i,a=[],l=new Set;i=s.shift();)a.push(O(i,l));return h(e.operation,l),r.fromArray(a)}))(r.filter((e=>o.has(e.operation.key)))(c));return r.merge([m,k,f])}},Le=e=>e&&e.networkError&&!e.response&&("undefined"!=typeof navigator&&!1===navigator.onLine||/request failed|failed to fetch|network\s?error/i.test(e.networkError.message));exports.Store=Oe,exports.cacheExchange=Fe,exports.offlineExchange=a=>n=>{var{storage:o}=a;if(o&&o.onOnline&&o.readMetadata&&o.writeMetadata){var{forward:l,client:p,dispatchDebug:v}=n,{source:f,next:y}=r.makeSubject(),g=a.optimistic||{},k=[],_=()=>{for(var e=[],r=0;r<k.length;r++){var i=k[r];"mutation"===i.kind&&e.push({query:t.print(i.query),variables:i.variables})}o.writeMetadata(e)},O=!1,w=()=>{if(!O){O=!0;for(var r=0;r<k.length;r++){var t=k[r];"mutation"===t.kind&&y(e.makeOperation("teardown",t))}for(var i=0;i<k.length;i++)p.reexecuteOperation(k[i]);k.length=0,O=!1,_()}};o.onOnline(w),o.readMetadata().then((r=>{if(r){for(var t=0;t<r.length;t++)k.push(p.createRequestOperation("mutation",e.createRequest(r[t].query,r[t].variables)));w()}}));var b=Fe({...a,storage:{...o,readData:()=>o.readData().finally(w)}})({client:p,dispatchDebug:v,forward:e=>r.filter((e=>"mutation"===e.operation.kind&&Le(e.error)&&((e,r)=>{for(var t,a=r.variables||{},n=m(r.query),o=[...s(c(r.query))];t=o.pop();)if(h(t,a))if(u(t)){if(e[i(t)])return!0}else{var l=d(t)?t:n[i(t)];l&&o.push(...s(l))}return!1})(g,e.operation)?(k.push(q.get(e.operation.context._instance)||e.operation),_(),!1):("mutation"!==e.operation.kind||e.error||q.delete(e.operation.context._instance),!0)))(l(e))}),q=new WeakMap;return e=>{var t=r.share(r.tap((e=>{"mutation"===e.kind&&q.set(e.context._instance,e)}))(e)),i=r.merge([f,t]);return r.filter((e=>"query"!==e.operation.kind||!Le(e.error)||(y(Te(e.operation,"cache-only")),k.push(e.operation),!1)))(b(i))}}return Fe(a)(n)},exports.query=we,exports.write=he;
//# sourceMappingURL=urql-exchange-graphcache.min.js.map
